(self.webpackChunksyncro_pi=self.webpackChunksyncro_pi||[]).push([[180],{5495:(e,o,n)=>{"use strict";n.r(o),n.d(o,{default:()=>w});var t=n(2791),i=n(7689),s=n(6234),l=n.n(s),d=n(8307),a=n.n(d),c=n(3968),r=n(3708),u=n(2852),v=n(9800),h=n(843),p=n(2790),f=n(6886),y=n(4420),m=n(8978),g=n(1930),k=n(3721),x=n(3329);const j=e=>{var o,n,s,d,j,w,b,_,I,N,T,C,S,R,U,P,M,Z,D;const A=(0,y.I0)(),E=(0,i.s0)(),L=(0,i.TH)(),W=(0,y.v9)(g.Df),O=(0,t.useRef)(0),[z,K]=(0,t.useState)(Object.assign(new(l())({accessToken:null===W||void 0===W||null===(o=W.tokens)||void 0===o?void 0:o.access_token,refreshToken:null===W||void 0===W||null===(n=W.tokens)||void 0===n?void 0:n.refresh_token,clientId:"f410a1b5124d4b7fa80e2ae6abf06dbe",redirectUri:"".concat(document.location.origin).concat("/".replace(/\/$/,""),"/spotify")}),a())),[H,$]=(0,t.useState)(null),[q,B]=(0,t.useState)(null),[F,G]=(0,t.useState)([]),[J,Q]=(0,t.useState)(null),V=e=>{const o=e.body||e;o&&!o.error&&A(k.ZP.setSpotify({tokens:o}))},X=(e,o)=>{var n,t;const{status:i,message:s}=(null===e||void 0===e||null===(n=e.body)||void 0===n?void 0:n.error)||{};console.error("Error",null===e||void 0===e?void 0:e.body,null===e||void 0===e?void 0:e.headers,null===e||void 0===e?void 0:e.statusCode),401!==i&&"invalid_grant"!==(null===e||void 0===e||null===(t=e.body)||void 0===t?void 0:t.error)?$(!1):ee().then((()=>{o&&o()}))},Y=async()=>{if(L.search.includes("error=access_denied"))return void $(!1);if(L.search.includes("state=".concat(W.state)))return void(()=>{const e=L.search.split("&").find((e=>e.includes("code="))).split("=")[1];return fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:["grant_type=authorization_code","code=".concat(e),"redirect_uri=".concat(encodeURIComponent(z.getRedirectURI())),"client_id=".concat(encodeURIComponent(z.getClientId())),"code_verifier=".concat(encodeURIComponent(W.challenge))].join("&")}).then((e=>e.json())).then(V).catch(X)})().then((()=>E("/spotify")));const e=z.createAuthorizeURL(["user-read-playback-state","user-modify-playback-state"],W.state);let o="";W.challenge||(o=m.O1(69),A(k.ZP.setSpotify({challenge:o})));const n=m.d(await m.Wu(W.challenge||o));window.location.href="".concat(e,"&code_challenge_method=S256&code_challenge=").concat(n)},ee=()=>z.getRefreshToken()?fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:["grant_type=refresh_token","refresh_token=".concat(encodeURIComponent(z.getRefreshToken())),"client_id=".concat(encodeURIComponent(z.getClientId()))].join("&")}).then((e=>e.json())).then(V).then(oe).catch(X):(Y(),Promise.reject()),oe=()=>{z.getAccessToken()?z.getMyCurrentPlaybackState().then((e=>{null===e.body?$(-1):$({...e.body,timestamp:Date.now()})})).catch(X):Y()},ne=()=>{null!==H&&void 0!==H&&H.is_playing?z.pause().then(oe).catch(X):z.play().then(oe).catch(X)},te=()=>{z.skipToNext().then(oe).catch(X)},ie=()=>{z.skipToPrevious().then(oe).catch(X)},se=()=>null!==H&&void 0!==H&&H.is_playing?((null===H||void 0===H?void 0:H.progress_ms)||0)+Date.now()-((null===H||void 0===H?void 0:H.timestamp)||0):null===H||void 0===H?void 0:H.progress_ms;return(0,f.y1)("*",(e=>{console.log(e),"MediaPlayPause"===e.key&&ne(),"MediaTrackPrevious"===e.key&&ie(),"MediaTrackNext"===e.key&&te()})),(0,t.useEffect)(oe,[]),(0,t.useEffect)((()=>{const e=setInterval((()=>{z.getAccessToken()&&oe()}),2500);return()=>clearInterval(e)}),[]),(0,t.useEffect)((()=>{var e,o;z.setAccessToken(null===(e=W.tokens)||void 0===e?void 0:e.access_token),z.setRefreshToken(null===(o=W.tokens)||void 0===o?void 0:o.refresh_token)}),[null===(s=W.tokens)||void 0===s?void 0:s.access_token,null===(d=W.tokens)||void 0===d?void 0:d.refresh_token]),(0,t.useEffect)((()=>{const e=setInterval((()=>Q(Date.now())),1e3);return()=>clearInterval(e)}),[]),null===H?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(c.Z,{className:"big-icon"}),(0,x.jsx)("div",{className:"loading-text show-unlit","data-unlit":m.ro("Music loading..."),children:"Music loading..."})]}):!1===H?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(r.Z,{className:"big-icon"}),(0,x.jsx)("div",{className:"loading-text show-unlit","data-unlit":m.ro("Music could not load"),children:"Music could not load"})]}):-1===H?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(c.Z,{className:"big-icon"}),(0,x.jsx)("div",{className:"loading-text show-unlit","data-unlit":m.ro("Music not playing"),children:"Music not playing"})]}):(0,x.jsxs)("div",{id:"spotify",children:[(0,x.jsxs)("div",{id:"spotify-song",children:[(0,x.jsx)("div",{id:"spotify-album",style:{backgroundImage:"url(".concat(null===H||void 0===H||null===(j=H.item)||void 0===j||null===(w=j.album)||void 0===w||null===(b=w.images[1])||void 0===b?void 0:b.url,")")}}),(0,x.jsx)("div",{id:"spotify-name",children:(0,x.jsx)("div",{ref:O,className:(O.current.offsetWidth||0)<(O.current.scrollWidth||0)?"":"show-unlit","data-unlit":m.ro((null===H||void 0===H||null===(_=H.item)||void 0===_?void 0:_.name)||"Unknown Song",[":"]),"data-overflow":((null===(I=O.current)||void 0===I?void 0:I.offsetWidth)||0)>((null===(N=O.current)||void 0===N||null===(T=N.parentNode)||void 0===T?void 0:T.offsetWidth)||0),children:(null===H||void 0===H||null===(C=H.item)||void 0===C?void 0:C.name)||"Unknown Song"})}),(0,x.jsx)("div",{id:"spotify-artist",className:"show-unlit","data-unlit":m.ro((null===H||void 0===H||null===(S=H.item)||void 0===S||null===(R=S.artists[0])||void 0===R?void 0:R.name)||"Unknown Artist",[":"]),children:(null===H||void 0===H||null===(U=H.item)||void 0===U||null===(P=U.artists[0])||void 0===P?void 0:P.name)||"Unknown Artist"})]}),(0,x.jsxs)("div",{id:"spotify-progress",children:[(0,x.jsx)("div",{id:"spotify-progress-current",className:"show-unlit","data-unlit":m.ro(m.Lc(se()),[":"]),children:m.Lc(se())}),(0,x.jsx)("div",{id:"spotify-progress-total",className:"show-unlit","data-unlit":m.ro(m.Lc(null===H||void 0===H||null===(M=H.item)||void 0===M?void 0:M.duration_ms),[":"]),children:m.Lc(null===H||void 0===H||null===(Z=H.item)||void 0===Z?void 0:Z.duration_ms)}),(0,x.jsx)("div",{id:"spotify-progress-fill",style:{width:"".concat(m.zo(se(),null===H||void 0===H||null===(D=H.item)||void 0===D?void 0:D.duration_ms),"%")}})]}),(0,x.jsxs)("div",{id:"spotify-controls",children:[(0,x.jsx)("div",{id:"spotify-prev",onClick:ie,onKeyDown:ie,role:"button",alt:"Previous Song",tabIndex:0,children:(0,x.jsx)(u.Z,{})}),(0,x.jsx)("div",{id:"spotify-play",onClick:ne,onKeyDown:ne,role:"button",tabIndex:0,children:null!==H&&void 0!==H&&H.is_playing?(0,x.jsx)(v.Z,{}):(0,x.jsx)(h.Z,{})}),(0,x.jsx)("div",{id:"spotify-next",onClick:te,onKeyDown:te,role:"button",alt:"Next Song",tabIndex:0,children:(0,x.jsx)(p.Z,{})})]})]})},w=j},4654:()=>{}}]);
//# sourceMappingURL=180.12565933.chunk.js.map