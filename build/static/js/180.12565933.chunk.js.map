{"version":3,"file":"static/js/180.12565933.chunk.js","mappings":"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","sources":["pages/Spotify/Spotify.jsx","pages/Spotify/index.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport SpotifyWebAPI from 'spotify-web-api-node';\nimport SpotifyWebAPIServer from 'spotify-web-api-node/src/server-methods';\nimport * as Icon from 'react-bootstrap-icons';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useDispatch, useSelector } from 'react-redux';\nimport * as Utility from '../../scripts/utility';\nimport { selectSpotifyState } from '../../store/store.selectors';\nimport storeActions from '../../store/store.redux';\n\nimport '../../css/spotify.css';\n\n// const SpotifyAPI = Object.assign(\n// \tnew SpotifyWebAPI({\n// \t\taccessToken: JSON.parse(localStorage.getItem('access-token'))?.access_token,\n// \t\trefreshToken: JSON.parse(localStorage.getItem('access-token'))?.refresh_token,\n// \t\tclientId: process.env.REACT_APP_SPOTIFY_CLIENT_ID,\n// \t\tredirectUri: `${location.origin}${process.env.REACT_APP_SUBDIRECTORY}/spotify`,\n// \t}),\n// \tSpotifyWebAPIServer,\n// );\n\nexport const Spotify = (props) => {\n\tconst dispatch = useDispatch();\n\tconst navigate = useNavigate();\n\tconst location = useLocation();\n\tconst spotify = useSelector(selectSpotifyState);\n\tconst marqueeRef = useRef(0);\n\tconst [spotifyAPI, setSpotifyAPI] = useState(\n\t\tObject.assign(\n\t\t\tnew SpotifyWebAPI({\n\t\t\t\taccessToken: spotify?.tokens?.access_token,\n\t\t\t\trefreshToken: spotify?.tokens?.refresh_token,\n\t\t\t\tclientId: process.env.REACT_APP_SPOTIFY_CLIENT_ID,\n\t\t\t\tredirectUri: `${document.location.origin}${process.env.REACT_APP_SUBDIRECTORY.replace(/\\/$/, '')}/spotify`,\n\t\t\t}),\n\t\t\tSpotifyWebAPIServer,\n\t\t),\n\t);\n\tconst [track, setTrack] = useState(null);\n\tconst [trackAnalysis, setTrackAnalysis] = useState(null);\n\tconst [pitches, setPitches] = useState([]);\n\tconst [lastRender, setLastRender] = useState(null);\n\n\n\tconst setTokens = (data) => {\n\t\tconst tokens = data.body || data;\n\n\t\tif (!tokens || tokens.error) return;\n\n\t\tdispatch(storeActions.setSpotify({ tokens }));\n\t};\n\n\tconst handleError = (err, retry) => {\n\t\tconst { status, message } = err?.body?.error || {};\n\t\tconsole.error('Error', err?.body, err?.headers, err?.statusCode);\n\n\t\tif (status === 401) {\n\t\t\treauthorize()\n\t\t\t\t.then(() => { if (retry) retry(); });\n\t\t\treturn;\n\t\t}\n\n\t\tif (err?.body?.error === 'invalid_grant') {\n\t\t\treauthorize()\n\t\t\t\t.then(() => { if (retry) retry();\t});\n\t\t\treturn;\n\t\t}\n\n\t\tsetTrack(false);\n\t};\n\n\tconst getAccessToken = () => {\n\t\tconst code = location.search\n\t\t\t.split('&')\n\t\t\t.find((p) => p.includes('code='))\n\t\t\t.split('=')[1];\n\n\t\t// Package does not support PKCE authorization\n\t\treturn fetch('https://accounts.spotify.com/api/token', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody: [\n\t\t\t\t`grant_type=authorization_code`,\n\t\t\t\t`code=${code}`,\n\t\t\t\t`redirect_uri=${encodeURIComponent(spotifyAPI.getRedirectURI())}`,\n\t\t\t\t`client_id=${encodeURIComponent(spotifyAPI.getClientId())}`,\n\t\t\t\t`code_verifier=${encodeURIComponent(spotify.challenge)}`,\n\t\t\t].join('&'),\n\t\t})\n\t\t\t.then((response) => response.json())\n\t\t\t.then(setTokens)\n\t\t\t.catch(handleError);\n\t};\n\n\tconst authorize = async () => {\n\t\tif (!process.env.REACT_APP_SPOTIFY_CLIENT_ID) {\n\t\t\tsetTrack(false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (location.search.includes('error=access_denied')) {\n\t\t\tsetTrack(false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (location.search.includes(`state=${spotify.state}`)) {\n\t\t\tgetAccessToken().then(() => navigate('/spotify'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst scopes = ['user-read-playback-state', 'user-modify-playback-state'];\n\t\tconst authURL = spotifyAPI.createAuthorizeURL(scopes, spotify.state);\n\n\t\tlet challenge = '';\n\t\tif(!spotify.challenge) {\n\t\t\tchallenge = Utility.randomString(69);\n\t\t\tdispatch(storeActions.setSpotify({challenge}));\n\t\t}\n\n\t\tconst challengeCode = Utility.base64URLEncode(await Utility.hashString(spotify.challenge || challenge));\n\n\t\twindow.location.href = `${authURL}&code_challenge_method=S256&code_challenge=${challengeCode}`;\n\t};\n\n\tconst reauthorize = () => {\n\t\tif (!spotifyAPI.getRefreshToken()) {\n\t\t\tauthorize();\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\t// Issues with spotify-web-api-node make this necessary for now\n\t\treturn fetch('https://accounts.spotify.com/api/token', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody: [\n\t\t\t\t`grant_type=refresh_token`,\n\t\t\t\t`refresh_token=${encodeURIComponent(spotifyAPI.getRefreshToken())}`,\n\t\t\t\t`client_id=${encodeURIComponent(spotifyAPI.getClientId())}`,\n\t\t\t].join('&'),\n\t\t})\n\t\t\t.then((response) => response.json())\n\t\t\t.then(setTokens)\n\t\t\t.then(updateStatus)\n\t\t\t.catch(handleError);\n\n\t\t// spotifyAPI.refreshAccessToken().then(setTokens).catch(handleError);\n\t};\n\n\tconst getTrackAnalysis = () => {\n\t\tif (!track?.item?.id) return;\n\n\t\tspotifyAPI\n\t\t\t.getAudioAnalysisForTrack(track?.item?.id)\n\t\t\t.then((data) => {\n\t\t\t\tif (data.body === null) setTrackAnalysis(-1);\n\t\t\t\telse setTrackAnalysis({ ...data.body, timestamp: Date.now() });\n\t\t\t})\n\t\t\t.catch(handleError);\n\t};\n\n\tconst updateStatus = () => {\n\t\tif (!spotifyAPI.getAccessToken()) {\n\t\t\tauthorize();\n\t\t\treturn;\n\t\t}\n\n\t\tspotifyAPI\n\t\t\t.getMyCurrentPlaybackState()\n\t\t\t.then((data) => {\n\t\t\t\tif (data.body === null) setTrack(-1);\n\t\t\t\telse setTrack({ ...data.body, timestamp: Date.now() });\n\t\t\t})\n\t\t\t.catch(handleError);\n\t};\n\n\tconst updatePitches = (currentTrack, currentAnalysis) => {\n\t\tif (!track?.is_playing) return;\n\n\t\tconst progress = getCurrentProgress() / 1000;\n\t\tconst segment = trackAnalysis?.segments?.find((s) => s.start >= progress);\n\n\t\tsetPitches(segment?.pitches || []);\n\t};\n\n\tconst playPause = () => {\n\t\tif (track?.is_playing) {\n\t\t\tspotifyAPI.pause().then(updateStatus).catch(handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tspotifyAPI.play().then(updateStatus).catch(handleError);\n\t};\n\n\tconst next = () => {\n\t\tspotifyAPI.skipToNext().then(updateStatus).catch(handleError);\n\t};\n\n\tconst previous = () => {\n\t\tspotifyAPI.skipToPrevious().then(updateStatus).catch(handleError);\n\t};\n\n\tconst getCurrentProgress = () =>\n\t\ttrack?.is_playing ? (track?.progress_ms || 0) + Date.now() - (track?.timestamp || 0) : track?.progress_ms;\n\n\tuseHotkeys('*', (ev) => {\n\t\tconsole.log(ev);\n\t\tif (ev.key === 'MediaPlayPause') playPause();\n\t\tif (ev.key === 'MediaTrackPrevious') previous();\n\t\tif (ev.key === 'MediaTrackNext') next();\n\t});\n\n\t// Get initial play state\n\tuseEffect(updateStatus, []);\n\n\t// Fetch track info\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\tif (!spotifyAPI.getAccessToken()) return;\n\n\t\t\tupdateStatus();\n\t\t}, 2500); // 2.5 seconds\n\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\t// If tokens ever change, update Spotify API\n\tuseEffect(() => {\n\t\tspotifyAPI.setAccessToken(spotify.tokens?.access_token);\n\t\tspotifyAPI.setRefreshToken(spotify.tokens?.refresh_token);\n\t}, [spotify.tokens?.access_token, spotify.tokens?.refresh_token]);\n\n\t// Update progress bar\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => setLastRender(Date.now()), 1000); // 1 second\n\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\t// Update graph\n\t// useEffect(() => {\n\t// \tconst interval = setInterval(updatePitches, 100); // 0.1 second\n\n\t// \treturn () => clearInterval(interval);\n\t// }, [track, trackAnalysis]);\n\n\t// Get track audio analysis on track change\n\t// useEffect(getTrackAnalysis, [track?.item?.id])\n\n\n\t// Loading or authenticating\n\tif (track === null)\n\t\treturn (\n\t\t\t<div className=\"loading-screen\">\n\t\t\t\t<Icon.Boombox className=\"big-icon\" />\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"loading-text show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD('Music loading...')}\n\t\t\t\t>\n\t\t\t\t\tMusic loading...\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\n\t// Error authenticating\n\tif (track === false)\n\t\treturn (\n\t\t\t<div className=\"loading-screen\">\n\t\t\t\t<Icon.VolumeMute className=\"big-icon\" />\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"loading-text show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD('Music could not load')}\n\t\t\t\t>\n\t\t\t\t\tMusic could not load\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\n\t// No music currently playing on Spotify\n\tif (track === -1)\n\t\treturn (\n\t\t\t<div className=\"loading-screen\">\n\t\t\t\t<Icon.Boombox className=\"big-icon\" />\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"loading-text show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD('Music not playing')}\n\t\t\t\t>\n\t\t\t\t\tMusic not playing\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\n\treturn (\n\t\t<div id=\"spotify\">\n\t\t\t<div id=\"spotify-song\">\n\t\t\t\t<div id=\"spotify-album\" style={{ backgroundImage: `url(${track?.item?.album?.images[1]?.url})` }} />\n\t\t\t\t<div id=\"spotify-name\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tref={marqueeRef}\n\t\t\t\t\t\tclassName={\n\t\t\t\t\t\t\t(marqueeRef.current.offsetWidth || 0) < (marqueeRef.current.scrollWidth || 0) ? '' : 'show-unlit'\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD(track?.item?.name || 'Unknown Song', [':'])}\n\t\t\t\t\t\tdata-overflow={(marqueeRef.current?.offsetWidth || 0) > (marqueeRef.current?.parentNode?.offsetWidth || 0)}\n\t\t\t\t\t>\n\t\t\t\t\t\t{track?.item?.name || 'Unknown Song'}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-artist\"\n\t\t\t\t\tclassName=\"show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD(track?.item?.artists[0]?.name || 'Unknown Artist', [':'])}\n\t\t\t\t>\n\t\t\t\t\t{track?.item?.artists[0]?.name || 'Unknown Artist'}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id=\"spotify-progress\">\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-progress-current\"\n\t\t\t\t\tclassName=\"show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD(Utility.msToDuration(getCurrentProgress()), [':'])}\n\t\t\t\t>\n\t\t\t\t\t{Utility.msToDuration(getCurrentProgress())}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-progress-total\"\n\t\t\t\t\tclassName=\"show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD(Utility.msToDuration(track?.item?.duration_ms), [':'])}\n\t\t\t\t>\n\t\t\t\t\t{Utility.msToDuration(track?.item?.duration_ms)}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-progress-fill\"\n\t\t\t\t\tstyle={{ width: `${Utility.ratioToPercent(getCurrentProgress(), track?.item?.duration_ms)}%` }}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div id=\"spotify-controls\">\n\t\t\t\t<div id=\"spotify-prev\" onClick={previous} onKeyDown={previous} role=\"button\" alt=\"Previous Song\" tabIndex={0}>\n\t\t\t\t\t<Icon.SkipStartFill />\n\t\t\t\t</div>\n\t\t\t\t<div id=\"spotify-play\" onClick={playPause} onKeyDown={playPause} role=\"button\" tabIndex={0}>\n\t\t\t\t\t{track?.is_playing ? <Icon.PauseFill /> : <Icon.PlayFill />}\n\t\t\t\t</div>\n\t\t\t\t<div id=\"spotify-next\" onClick={next} onKeyDown={next} role=\"button\" alt=\"Next Song\" tabIndex={0}>\n\t\t\t\t\t<Icon.SkipEndFill />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{/* <div id=\"spotify-graph\"> */}\n\t\t\t{/* eslint-disable-next-line react/no-array-index-key */}\n\t\t\t{/* {pitches.map((p, i) => <div key={i} style={{height: `${p}em`}} />)} */}\n\t\t\t{/* </div> */}\n\t\t</div>\n\t);\n};\n\nexport default Spotify;\n","import Spotify from './Spotify';\n\nexport default Spotify;"],"names":["props","_spotify$tokens","_spotify$tokens2","_spotify$tokens5","_spotify$tokens6","_track$item3","_track$item3$album","_track$item3$album$im","_track$item4","_marqueeRef$current","_marqueeRef$current2","_marqueeRef$current2$","_track$item5","_track$item6","_track$item6$artists$","_track$item7","_track$item7$artists$","_track$item8","_track$item9","_track$item10","dispatch","useDispatch","navigate","useNavigate","location","useLocation","spotify","useSelector","selectSpotifyState","marqueeRef","useRef","spotifyAPI","setSpotifyAPI","useState","Object","assign","SpotifyWebAPI","accessToken","tokens","access_token","refreshToken","refresh_token","clientId","process","redirectUri","concat","document","origin","replace","SpotifyWebAPIServer","track","setTrack","trackAnalysis","setTrackAnalysis","pitches","setPitches","lastRender","setLastRender","setTokens","data","body","error","storeActions","setSpotify","handleError","err","retry","_err$body","_err$body2","status","message","console","headers","statusCode","reauthorize","then","authorize","async","search","includes","state","getAccessToken","code","split","find","p","fetch","method","encodeURIComponent","getRedirectURI","getClientId","challenge","join","response","json","catch","authURL","createAuthorizeURL","Utility","challengeCode","window","href","getRefreshToken","updateStatus","Promise","reject","getMyCurrentPlaybackState","timestamp","Date","now","playPause","is_playing","pause","play","next","skipToNext","previous","skipToPrevious","getCurrentProgress","progress_ms","useHotkeys","ev","log","key","useEffect","interval","setInterval","clearInterval","_spotify$tokens3","_spotify$tokens4","setAccessToken","setRefreshToken","_jsxs","className","children","_jsx","Icon","id","style","backgroundImage","item","album","images","url","ref","current","offsetWidth","scrollWidth","name","parentNode","artists","duration_ms","width","onClick","onKeyDown","role","alt","tabIndex"],"sourceRoot":""}