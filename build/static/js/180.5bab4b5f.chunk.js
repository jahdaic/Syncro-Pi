(self.webpackChunksyncro_pi=self.webpackChunksyncro_pi||[]).push([[180],{5495:(e,n,o)=>{"use strict";o.r(n),o.d(n,{default:()=>b});var t=o(2791),i=o(7689),s=o(6234),l=o.n(s),d=o(8307),c=o.n(d),a=o(3968),r=o(3708),u=o(2852),v=o(7203),h=o(3417),p=o(2790),y=o(6886),f=o(4420),m=o(8978),g=o(1930),k=o(3721),x=o(3329);const j=e=>{var n,o,s,d,j,b,w,_,I,T,C,S,N,P;const U=(0,f.I0)(),R=(0,i.s0)(),Z=(0,i.TH)(),D=(0,f.v9)(g.Df),[M,A]=(0,t.useState)(Object.assign(new(l())({accessToken:null===D||void 0===D||null===(n=D.tokens)||void 0===n?void 0:n.access_token,refreshToken:null===D||void 0===D||null===(o=D.tokens)||void 0===o?void 0:o.refresh_token,clientId:"f410a1b5124d4b7fa80e2ae6abf06dbe",redirectUri:"".concat(document.location.origin,"/Syncro-Pi/spotify")}),c())),[E,L]=(0,t.useState)(null),[O,z]=(0,t.useState)(null),[K,F]=(0,t.useState)([]),[H,W]=(0,t.useState)(null);console.log("SPOTIFY",D);const Y=e=>{const n=e.body||e;n&&(U(k.ZP.setSpotify({tokens:n})),M.setAccessToken(n.access_token),M.setRefreshToken(n.refresh_token))},q=(e,n)=>{var o,t;const{status:i,message:s}=(null===e||void 0===e||null===(o=e.body)||void 0===o?void 0:o.error)||{};console.error("Error",null===e||void 0===e?void 0:e.body,null===e||void 0===e?void 0:e.headers,null===e||void 0===e?void 0:e.statusCode),401!==i&&"invalid_grant"!==(null===e||void 0===e||null===(t=e.body)||void 0===t?void 0:t.error)?L(!1):G().then((()=>{n&&n()}))},B=async()=>{if(Z.search.includes("error=access_denied"))return void L(!1);if(Z.search.includes("state=".concat(D.state)))return void(()=>{const e=Z.search.split("&").find((e=>e.includes("code="))).split("=")[1];return fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:["grant_type=authorization_code","code=".concat(e),"redirect_uri=".concat(encodeURIComponent(M.getRedirectURI())),"client_id=".concat(encodeURIComponent(M.getClientId())),"code_verifier=".concat(encodeURIComponent(D.challenge))].join("&")}).then((e=>e.json())).then(Y).catch(q)})().then((()=>R("/spotify")));const e=M.createAuthorizeURL(["user-read-playback-state","user-modify-playback-state"],D.state),n=m.d(await m.Wu(D.challenge));window.location.href="".concat(e,"&code_challenge_method=S256&code_challenge=").concat(n)},G=()=>M.getRefreshToken()?fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:["grant_type=refresh_token","refresh_token=".concat(encodeURIComponent(M.getRefreshToken())),"client_id=".concat(encodeURIComponent(M.getClientId()))].join("&")}).then((e=>e.json())).then(Y).then(J).catch(q):(B(),Promise.reject()),J=()=>{M.getAccessToken()?M.getMyCurrentPlaybackState().then((e=>{null===e.body?L(-1):L({...e.body,timestamp:Date.now()})})).catch(q):B()},Q=(e,n)=>{var o;if(null===E||void 0===E||!E.is_playing)return;const t=ee()/1e3,i=null===O||void 0===O||null===(o=O.segments)||void 0===o?void 0:o.find((e=>e.start>=t));F((null===i||void 0===i?void 0:i.pitches)||[])},V=()=>{null!==E&&void 0!==E&&E.is_playing?M.pause().then(J).catch(q):M.play().then(J).catch(q)},X=()=>{M.skipToNext().then(J).catch(q)},$=()=>{M.skipToPrevious().then(J).catch(q)},ee=()=>null!==E&&void 0!==E&&E.is_playing?((null===E||void 0===E?void 0:E.progress_ms)||0)+Date.now()-((null===E||void 0===E?void 0:E.timestamp)||0):null===E||void 0===E?void 0:E.progress_ms;return(0,y.y1)("*",(e=>{console.log(e),"MediaPlayPause"===e.key&&V(),"MediaTrackPrevious"===e.key&&$(),"MediaTrackNext"===e.key&&X()})),(0,t.useEffect)((()=>{const e=setInterval((()=>{M.getAccessToken()&&J()}),2500);return()=>clearInterval(e)}),[]),(0,t.useEffect)((()=>{const e=setInterval((()=>W(Date.now())),1e3);return()=>clearInterval(e)}),[]),(0,t.useEffect)((()=>{const e=setInterval(Q,100);return()=>clearInterval(e)}),[E,O]),(0,t.useEffect)(J,[]),null===E?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(a.Z,{className:"big-icon"}),(0,x.jsx)("div",{id:"weather-description",children:"Music loading..."})]}):!1===E?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(r.Z,{className:"big-icon"}),(0,x.jsx)("div",{id:"weather-description",children:"Music could not load"})]}):-1===E?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(a.Z,{className:"big-icon"}),(0,x.jsx)("div",{id:"weather-description",children:"Music not playing"})]}):(0,x.jsxs)("div",{id:"spotify",children:[(0,x.jsxs)("div",{id:"spotify-song",children:[(0,x.jsx)("div",{id:"spotify-album",style:{backgroundImage:"url(".concat(null===E||void 0===E||null===(s=E.item)||void 0===s||null===(d=s.album)||void 0===d||null===(j=d.images[1])||void 0===j?void 0:j.url,")")}}),(0,x.jsx)("div",{id:"spotify-name",className:"show-unlit","data-unlit":m.ro((null===E||void 0===E||null===(b=E.item)||void 0===b?void 0:b.name)||"Unknown Song",[":"]),children:(null===E||void 0===E||null===(w=E.item)||void 0===w?void 0:w.name)||"Unknown Song"}),(0,x.jsx)("div",{id:"spotify-artist",className:"show-unlit","data-unlit":m.ro((null===E||void 0===E||null===(_=E.item)||void 0===_||null===(I=_.artists[0])||void 0===I?void 0:I.name)||"Unknown Artist",[":"]),children:(null===E||void 0===E||null===(T=E.item)||void 0===T||null===(C=T.artists[0])||void 0===C?void 0:C.name)||"Unknown Artist"})]}),(0,x.jsxs)("div",{id:"spotify-progress",children:[(0,x.jsx)("div",{id:"spotify-progress-current",className:"show-unlit","data-unlit":m.ro(m.Lc(ee()),[":"]),children:m.Lc(ee())}),(0,x.jsx)("div",{id:"spotify-progress-total",className:"show-unlit","data-unlit":m.ro(m.Lc(null===E||void 0===E||null===(S=E.item)||void 0===S?void 0:S.duration_ms),[":"]),children:m.Lc(null===E||void 0===E||null===(N=E.item)||void 0===N?void 0:N.duration_ms)}),(0,x.jsx)("div",{id:"spotify-progress-fill",style:{width:"".concat(m.zo(ee(),null===E||void 0===E||null===(P=E.item)||void 0===P?void 0:P.duration_ms),"%")}})]}),(0,x.jsxs)("div",{id:"spotify-controls",children:[(0,x.jsx)("div",{id:"spotify-prev",onClick:$,onKeyDown:$,role:"button",alt:"Previous Song",tabIndex:0,children:(0,x.jsx)(u.Z,{})}),(0,x.jsx)("div",{id:"spotify-play",onClick:V,onKeyDown:V,role:"button",tabIndex:0,children:null!==E&&void 0!==E&&E.is_playing?(0,x.jsx)(v.Z,{}):(0,x.jsx)(h.Z,{})}),(0,x.jsx)("div",{id:"spotify-next",onClick:X,onKeyDown:X,role:"button",alt:"Next Song",tabIndex:0,children:(0,x.jsx)(p.Z,{})})]})]})},b=j},4654:()=>{}}]);
//# sourceMappingURL=180.5bab4b5f.chunk.js.map