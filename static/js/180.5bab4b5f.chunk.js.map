{"version":3,"file":"static/js/180.5bab4b5f.chunk.js","mappings":"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","sources":["pages/Spotify/Spotify.jsx","pages/Spotify/index.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport SpotifyWebAPI from 'spotify-web-api-node';\nimport SpotifyWebAPIServer from 'spotify-web-api-node/src/server-methods';\nimport * as Icon from 'react-bootstrap-icons';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useDispatch, useSelector } from 'react-redux';\nimport * as Utility from '../../scripts/utility';\nimport { selectSpotifyState } from '../../store/store.selectors';\nimport storeActions from '../../store/store.redux';\n\nimport '../../css/spotify.css';\n\n// const SpotifyAPI = Object.assign(\n// \tnew SpotifyWebAPI({\n// \t\taccessToken: JSON.parse(localStorage.getItem('access-token'))?.access_token,\n// \t\trefreshToken: JSON.parse(localStorage.getItem('access-token'))?.refresh_token,\n// \t\tclientId: process.env.REACT_APP_SPOTIFY_CLIENT_ID,\n// \t\tredirectUri: `${location.origin}/Syncro-Pi/spotify`,\n// \t}),\n// \tSpotifyWebAPIServer,\n// );\n\nexport const Spotify = (props) => {\n\tconst dispatch = useDispatch();\n\tconst navigate = useNavigate();\n\tconst location = useLocation();\n\tconst spotify = useSelector(selectSpotifyState);\n\tconst [spotifyAPI, setSpotifyAPI] = useState(\n\t\tObject.assign(\n\t\t\tnew SpotifyWebAPI({\n\t\t\t\taccessToken: spotify?.tokens?.access_token,\n\t\t\t\trefreshToken: spotify?.tokens?.refresh_token,\n\t\t\t\tclientId: process.env.REACT_APP_SPOTIFY_CLIENT_ID,\n\t\t\t\tredirectUri: `${document.location.origin}/Syncro-Pi/spotify`,\n\t\t\t}),\n\t\t\tSpotifyWebAPIServer,\n\t\t),\n\t);\n\tconst [track, setTrack] = useState(null);\n\tconst [trackAnalysis, setTrackAnalysis] = useState(null);\n\tconst [pitches, setPitches] = useState([]);\n\tconst [lastRender, setLastRender] = useState(null);\n\n\tconsole.log('SPOTIFY', spotify);\n\n\tconst setTokens = (data) => {\n\t\tconst tokens = data.body || data;\n\n\t\tif (!tokens) return;\n\n\t\t// localStorage.setItem('access-token', JSON.stringify(tokens));\n\t\tdispatch(storeActions.setSpotify({ tokens }));\n\n\t\tspotifyAPI.setAccessToken(tokens.access_token);\n\t\tspotifyAPI.setRefreshToken(tokens.refresh_token);\n\t};\n\n\tconst handleError = (err, retry) => {\n\t\tconst { status, message } = err?.body?.error || {};\n\t\tconsole.error('Error', err?.body, err?.headers, err?.statusCode);\n\n\t\tif (status === 401) {\n\t\t\treauthorize().then(() => {\n\t\t\t\tif (retry) retry();\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (err?.body?.error === 'invalid_grant') {\n\t\t\treauthorize().then(() => {\n\t\t\t\tif (retry) retry();\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tsetTrack(false);\n\t};\n\n\tconst getAccessToken = () => {\n\t\tconst code = location.search\n\t\t\t.split('&')\n\t\t\t.find((p) => p.includes('code='))\n\t\t\t.split('=')[1];\n\n\t\t// Package does not support PKCE authorization\n\t\treturn fetch('https://accounts.spotify.com/api/token', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody: [\n\t\t\t\t`grant_type=authorization_code`,\n\t\t\t\t`code=${code}`,\n\t\t\t\t`redirect_uri=${encodeURIComponent(spotifyAPI.getRedirectURI())}`,\n\t\t\t\t`client_id=${encodeURIComponent(spotifyAPI.getClientId())}`,\n\t\t\t\t`code_verifier=${encodeURIComponent(spotify.challenge)}`,\n\t\t\t].join('&'),\n\t\t})\n\t\t\t.then((response) => response.json())\n\t\t\t.then(setTokens)\n\t\t\t.catch(handleError);\n\t};\n\n\tconst authorize = async () => {\n\t\tif (!process.env.REACT_APP_SPOTIFY_CLIENT_ID) {\n\t\t\tsetTrack(false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (location.search.includes('error=access_denied')) {\n\t\t\tsetTrack(false);\n\t\t\treturn;\n\t\t}\n\n\t\tif (location.search.includes(`state=${spotify.state}`)) {\n\t\t\tgetAccessToken().then(() => navigate('/spotify'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst scopes = ['user-read-playback-state', 'user-modify-playback-state'];\n\t\tconst authURL = spotifyAPI.createAuthorizeURL(scopes, spotify.state);\n\t\tconst challengeCode = Utility.base64URLEncode(await Utility.hashString(spotify.challenge));\n\n\t\twindow.location.href = `${authURL}&code_challenge_method=S256&code_challenge=${challengeCode}`;\n\t};\n\n\tconst reauthorize = () => {\n\t\tif (!spotifyAPI.getRefreshToken()) {\n\t\t\tauthorize();\n\t\t\treturn Promise.reject();\n\t\t}\n\n\t\t// Issues with spotify-web-api-node make this necessary for now\n\t\treturn fetch('https://accounts.spotify.com/api/token', {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t},\n\t\t\tbody: [\n\t\t\t\t`grant_type=refresh_token`,\n\t\t\t\t`refresh_token=${encodeURIComponent(spotifyAPI.getRefreshToken())}`,\n\t\t\t\t`client_id=${encodeURIComponent(spotifyAPI.getClientId())}`,\n\t\t\t].join('&'),\n\t\t})\n\t\t\t.then((response) => response.json())\n\t\t\t.then(setTokens)\n\t\t\t.then(updateStatus)\n\t\t\t.catch(handleError);\n\n\t\t// spotifyAPI.refreshAccessToken().then(setTokens).catch(handleError);\n\t};\n\n\tconst getTrackAnalysis = () => {\n\t\tif (!track?.item?.id) {\n\t\t\treturn;\n\t\t}\n\n\t\tspotifyAPI\n\t\t\t.getAudioAnalysisForTrack(track?.item?.id)\n\t\t\t.then((data) => {\n\t\t\t\tif (data.body === null) setTrackAnalysis(-1);\n\t\t\t\telse setTrackAnalysis({ ...data.body, timestamp: Date.now() });\n\t\t\t})\n\t\t\t.catch(handleError);\n\t};\n\n\tconst updateStatus = () => {\n\t\tif (!spotifyAPI.getAccessToken()) {\n\t\t\tauthorize();\n\t\t\treturn;\n\t\t}\n\n\t\tspotifyAPI\n\t\t\t.getMyCurrentPlaybackState()\n\t\t\t.then((data) => {\n\t\t\t\tif (data.body === null) setTrack(-1);\n\t\t\t\telse setTrack({ ...data.body, timestamp: Date.now() });\n\t\t\t})\n\t\t\t.catch(handleError);\n\t};\n\n\tconst updatePitches = (currentTrack, currentAnalysis) => {\n\t\tif (!track?.is_playing) return;\n\n\t\tconst progress = getCurrentProgress() / 1000;\n\t\tconst segment = trackAnalysis?.segments?.find((s) => s.start >= progress);\n\n\t\tsetPitches(segment?.pitches || []);\n\t};\n\n\tconst playPause = () => {\n\t\tif (track?.is_playing) {\n\t\t\tspotifyAPI.pause().then(updateStatus).catch(handleError);\n\t\t\treturn;\n\t\t}\n\n\t\tspotifyAPI.play().then(updateStatus).catch(handleError);\n\t};\n\n\tconst next = () => {\n\t\tspotifyAPI.skipToNext().then(updateStatus).catch(handleError);\n\t};\n\n\tconst previous = () => {\n\t\tspotifyAPI.skipToPrevious().then(updateStatus).catch(handleError);\n\t};\n\n\tconst getCurrentProgress = () =>\n\t\ttrack?.is_playing ? (track?.progress_ms || 0) + Date.now() - (track?.timestamp || 0) : track?.progress_ms;\n\n\tuseHotkeys('*', (ev) => {\n\t\tconsole.log(ev);\n\t\tif (ev.key === 'MediaPlayPause') playPause();\n\t\tif (ev.key === 'MediaTrackPrevious') previous();\n\t\tif (ev.key === 'MediaTrackNext') next();\n\t});\n\n\t// Fetch track info\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => {\n\t\t\tif (!spotifyAPI.getAccessToken()) return;\n\t\t\tupdateStatus();\n\t\t}, 2500); // 2.5 seconds\n\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\t// Update progress bar\n\tuseEffect(() => {\n\t\tconst interval = setInterval(() => setLastRender(Date.now()), 1000); // 1 second\n\n\t\treturn () => clearInterval(interval);\n\t}, []);\n\n\t// Update graph\n\tuseEffect(() => {\n\t\tconst interval = setInterval(updatePitches, 100); // 0.1 second\n\n\t\treturn () => clearInterval(interval);\n\t}, [track, trackAnalysis]);\n\n\t// Get track audio analysis on track change\n\t// useEffect(getTrackAnalysis, [track?.item?.id])\n\n\t// Get initial play state\n\tuseEffect(updateStatus, []);\n\n\t// Loading or authenticating\n\tif (track === null)\n\t\treturn (\n\t\t\t<div className=\"loading-screen\">\n\t\t\t\t<Icon.Boombox className=\"big-icon\" />\n\t\t\t\t<div id=\"weather-description\">Music loading...</div>\n\t\t\t</div>\n\t\t);\n\n\t// Error authenticating\n\tif (track === false)\n\t\treturn (\n\t\t\t<div className=\"loading-screen\">\n\t\t\t\t<Icon.VolumeMute className=\"big-icon\" />\n\t\t\t\t<div id=\"weather-description\">Music could not load</div>\n\t\t\t</div>\n\t\t);\n\n\t// No music currently playing on Spotify\n\tif (track === -1)\n\t\treturn (\n\t\t\t<div className=\"loading-screen\">\n\t\t\t\t<Icon.Boombox className=\"big-icon\" />\n\t\t\t\t<div id=\"weather-description\">Music not playing</div>\n\t\t\t</div>\n\t\t);\n\n\treturn (\n\t\t<div id=\"spotify\">\n\t\t\t<div id=\"spotify-song\">\n\t\t\t\t<div id=\"spotify-album\" style={{ backgroundImage: `url(${track?.item?.album?.images[1]?.url})` }} />\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-name\"\n\t\t\t\t\tclassName=\"show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD(track?.item?.name || 'Unknown Song', [':'])}\n\t\t\t\t>\n\t\t\t\t\t{track?.item?.name || 'Unknown Song'}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-artist\"\n\t\t\t\t\tclassName=\"show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD(track?.item?.artists[0]?.name || 'Unknown Artist', [':'])}\n\t\t\t\t>\n\t\t\t\t\t{track?.item?.artists[0]?.name || 'Unknown Artist'}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id=\"spotify-progress\">\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-progress-current\"\n\t\t\t\t\tclassName=\"show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD(Utility.msToDuration(getCurrentProgress()), [':'])}\n\t\t\t\t>\n\t\t\t\t\t{Utility.msToDuration(getCurrentProgress())}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-progress-total\"\n\t\t\t\t\tclassName=\"show-unlit\"\n\t\t\t\t\tdata-unlit={Utility.generateUnlitLCD(Utility.msToDuration(track?.item?.duration_ms), [':'])}\n\t\t\t\t>\n\t\t\t\t\t{Utility.msToDuration(track?.item?.duration_ms)}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tid=\"spotify-progress-fill\"\n\t\t\t\t\tstyle={{ width: `${Utility.ratioToPercent(getCurrentProgress(), track?.item?.duration_ms)}%` }}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t\t<div id=\"spotify-controls\">\n\t\t\t\t<div id=\"spotify-prev\" onClick={previous} onKeyDown={previous} role=\"button\" alt=\"Previous Song\" tabIndex={0}>\n\t\t\t\t\t<Icon.SkipStartFill />\n\t\t\t\t</div>\n\t\t\t\t<div id=\"spotify-play\" onClick={playPause} onKeyDown={playPause} role=\"button\" tabIndex={0}>\n\t\t\t\t\t{track?.is_playing ? <Icon.PauseCircle /> : <Icon.PlayCircle />}\n\t\t\t\t</div>\n\t\t\t\t<div id=\"spotify-next\" onClick={next} onKeyDown={next} role=\"button\" alt=\"Next Song\" tabIndex={0}>\n\t\t\t\t\t<Icon.SkipEndFill />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{/* <div id=\"spotify-graph\"> */}\n\t\t\t{/* eslint-disable-next-line react/no-array-index-key */}\n\t\t\t{/* {pitches.map((p, i) => <div key={i} style={{height: `${p}em`}} />)} */}\n\t\t\t{/* </div> */}\n\t\t</div>\n\t);\n};\n\nexport default Spotify;\n","import Spotify from './Spotify';\n\nexport default Spotify;"],"names":["props","_spotify$tokens","_spotify$tokens2","_track$item3","_track$item3$album","_track$item3$album$im","_track$item4","_track$item5","_track$item6","_track$item6$artists$","_track$item7","_track$item7$artists$","_track$item8","_track$item9","_track$item10","dispatch","useDispatch","navigate","useNavigate","location","useLocation","spotify","useSelector","selectSpotifyState","spotifyAPI","setSpotifyAPI","useState","Object","assign","SpotifyWebAPI","accessToken","tokens","access_token","refreshToken","refresh_token","clientId","process","redirectUri","concat","document","origin","SpotifyWebAPIServer","track","setTrack","trackAnalysis","setTrackAnalysis","pitches","setPitches","lastRender","setLastRender","console","log","setTokens","data","body","storeActions","setSpotify","setAccessToken","setRefreshToken","handleError","err","retry","_err$body","_err$body2","status","message","error","headers","statusCode","reauthorize","then","authorize","async","search","includes","state","getAccessToken","code","split","find","p","fetch","method","encodeURIComponent","getRedirectURI","getClientId","challenge","join","response","json","catch","authURL","createAuthorizeURL","challengeCode","Utility","window","href","getRefreshToken","updateStatus","Promise","reject","getMyCurrentPlaybackState","timestamp","Date","now","updatePitches","currentTrack","currentAnalysis","_trackAnalysis$segmen","is_playing","progress","getCurrentProgress","segment","segments","s","start","playPause","pause","play","next","skipToNext","previous","skipToPrevious","progress_ms","useHotkeys","ev","key","useEffect","interval","setInterval","clearInterval","_jsxs","className","children","_jsx","Icon","id","style","backgroundImage","item","album","images","url","name","artists","duration_ms","width","onClick","onKeyDown","role","alt","tabIndex"],"sourceRoot":""}