(self.webpackChunksyncro_pi=self.webpackChunksyncro_pi||[]).push([[180],{5495:(e,n,o)=>{"use strict";o.r(n),o.d(n,{default:()=>w});var t=o(2791),i=o(7689),s=o(6234),l=o.n(s),d=o(8307),c=o.n(d),a=o(3968),r=o(3708),u=o(2852),v=o(9800),h=o(843),p=o(2790),f=o(6886),y=o(4420),m=o(8978),g=o(1930),k=o(3721),x=o(3329);const j=e=>{var n,o,s,d,j,w,b,_,I,T,C,S,N,P;const R=(0,y.I0)(),U=(0,i.s0)(),Z=(0,i.TH)(),D=(0,y.v9)(g.Df),M=(0,t.useRef)(0),[A,L]=(0,t.useState)(Object.assign(new(l())({accessToken:null===D||void 0===D||null===(n=D.tokens)||void 0===n?void 0:n.access_token,refreshToken:null===D||void 0===D||null===(o=D.tokens)||void 0===o?void 0:o.refresh_token,clientId:"f410a1b5124d4b7fa80e2ae6abf06dbe",redirectUri:"".concat(document.location.origin,"/Syncro-Pi/spotify")}),c())),[W,E]=(0,t.useState)(null),[O,z]=(0,t.useState)(null),[K,H]=(0,t.useState)([]),[q,B]=(0,t.useState)(null),F=e=>{const n=e.body||e;n&&(R(k.ZP.setSpotify({tokens:n})),A.setAccessToken(n.access_token),A.setRefreshToken(n.refresh_token))},G=(e,n)=>{var o,t;const{status:i,message:s}=(null===e||void 0===e||null===(o=e.body)||void 0===o?void 0:o.error)||{};console.error("Error",null===e||void 0===e?void 0:e.body,null===e||void 0===e?void 0:e.headers,null===e||void 0===e?void 0:e.statusCode),401!==i&&"invalid_grant"!==(null===e||void 0===e||null===(t=e.body)||void 0===t?void 0:t.error)?E(!1):Q().then((()=>{n&&n()}))},J=async()=>{if(Z.search.includes("error=access_denied"))return void E(!1);if(Z.search.includes("state=".concat(D.state)))return void(()=>{const e=Z.search.split("&").find((e=>e.includes("code="))).split("=")[1];return fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:["grant_type=authorization_code","code=".concat(e),"redirect_uri=".concat(encodeURIComponent(A.getRedirectURI())),"client_id=".concat(encodeURIComponent(A.getClientId())),"code_verifier=".concat(encodeURIComponent(D.challenge))].join("&")}).then((e=>e.json())).then(F).catch(G)})().then((()=>U("/spotify")));const e=A.createAuthorizeURL(["user-read-playback-state","user-modify-playback-state"],D.state);let n="";D.challenge||(n=m.O1(69),R(k.ZP.setSpotify({challenge:n})));const o=m.d(await m.Wu(D.challenge||n));window.location.href="".concat(e,"&code_challenge_method=S256&code_challenge=").concat(o)},Q=()=>A.getRefreshToken()?fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:["grant_type=refresh_token","refresh_token=".concat(encodeURIComponent(A.getRefreshToken())),"client_id=".concat(encodeURIComponent(A.getClientId()))].join("&")}).then((e=>e.json())).then(F).then(V).catch(G):(J(),Promise.reject()),V=()=>{A.getAccessToken()?A.getMyCurrentPlaybackState().then((e=>{null===e.body?E(-1):E({...e.body,timestamp:Date.now()})})).catch(G):J()},X=()=>{null!==W&&void 0!==W&&W.is_playing?A.pause().then(V).catch(G):A.play().then(V).catch(G)},Y=()=>{A.skipToNext().then(V).catch(G)},$=()=>{A.skipToPrevious().then(V).catch(G)},ee=()=>null!==W&&void 0!==W&&W.is_playing?((null===W||void 0===W?void 0:W.progress_ms)||0)+Date.now()-((null===W||void 0===W?void 0:W.timestamp)||0):null===W||void 0===W?void 0:W.progress_ms;return(0,f.y1)("*",(e=>{console.log(e),"MediaPlayPause"===e.key&&X(),"MediaTrackPrevious"===e.key&&$(),"MediaTrackNext"===e.key&&Y()})),(0,t.useEffect)((()=>{const e=setInterval((()=>{A.getAccessToken()&&V()}),2500);return()=>clearInterval(e)}),[]),(0,t.useEffect)((()=>{const e=setInterval((()=>B(Date.now())),1e3);return()=>clearInterval(e)}),[]),(0,t.useEffect)(V,[]),null===W?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(a.Z,{className:"big-icon"}),(0,x.jsx)("div",{id:"weather-description",children:"Music loading..."})]}):!1===W?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(r.Z,{className:"big-icon"}),(0,x.jsx)("div",{id:"weather-description",children:"Music could not load"})]}):-1===W?(0,x.jsxs)("div",{className:"loading-screen",children:[(0,x.jsx)(a.Z,{className:"big-icon"}),(0,x.jsx)("div",{id:"weather-description",children:"Music not playing"})]}):(0,x.jsxs)("div",{id:"spotify",children:[(0,x.jsxs)("div",{id:"spotify-song",children:[(0,x.jsx)("div",{id:"spotify-album",style:{backgroundImage:"url(".concat(null===W||void 0===W||null===(s=W.item)||void 0===s||null===(d=s.album)||void 0===d||null===(j=d.images[1])||void 0===j?void 0:j.url,")")}}),(0,x.jsx)("div",{id:"spotify-name",children:(0,x.jsx)("div",{ref:M,className:(M.current.offsetWidth||0)<(M.current.scrollWidth||0)?"":"show-unlit","data-unlit":m.ro((null===W||void 0===W||null===(w=W.item)||void 0===w?void 0:w.name)||"Unknown Song",[":"]),"data-overflow":(M.current.offsetWidth||0)<(M.current.scrollWidth||0),children:(null===W||void 0===W||null===(b=W.item)||void 0===b?void 0:b.name)||"Unknown Song"})}),(0,x.jsx)("div",{id:"spotify-artist",className:"show-unlit","data-unlit":m.ro((null===W||void 0===W||null===(_=W.item)||void 0===_||null===(I=_.artists[0])||void 0===I?void 0:I.name)||"Unknown Artist",[":"]),children:(null===W||void 0===W||null===(T=W.item)||void 0===T||null===(C=T.artists[0])||void 0===C?void 0:C.name)||"Unknown Artist"})]}),(0,x.jsxs)("div",{id:"spotify-progress",children:[(0,x.jsx)("div",{id:"spotify-progress-current",className:"show-unlit","data-unlit":m.ro(m.Lc(ee()),[":"]),children:m.Lc(ee())}),(0,x.jsx)("div",{id:"spotify-progress-total",className:"show-unlit","data-unlit":m.ro(m.Lc(null===W||void 0===W||null===(S=W.item)||void 0===S?void 0:S.duration_ms),[":"]),children:m.Lc(null===W||void 0===W||null===(N=W.item)||void 0===N?void 0:N.duration_ms)}),(0,x.jsx)("div",{id:"spotify-progress-fill",style:{width:"".concat(m.zo(ee(),null===W||void 0===W||null===(P=W.item)||void 0===P?void 0:P.duration_ms),"%")}})]}),(0,x.jsxs)("div",{id:"spotify-controls",children:[(0,x.jsx)("div",{id:"spotify-prev",onClick:$,onKeyDown:$,role:"button",alt:"Previous Song",tabIndex:0,children:(0,x.jsx)(u.Z,{})}),(0,x.jsx)("div",{id:"spotify-play",onClick:X,onKeyDown:X,role:"button",tabIndex:0,children:null!==W&&void 0!==W&&W.is_playing?(0,x.jsx)(v.Z,{}):(0,x.jsx)(h.Z,{})}),(0,x.jsx)("div",{id:"spotify-next",onClick:Y,onKeyDown:Y,role:"button",alt:"Next Song",tabIndex:0,children:(0,x.jsx)(p.Z,{})})]})]})},w=j},4654:()=>{}}]);
//# sourceMappingURL=180.d1f2825c.chunk.js.map